'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

exports.default = function (context) {
  var queryParams = context.queryParams,
      reduxStore = context.reduxStore,
      window = context.window,
      channel = context.channel;
  // set the story if correct params are loaded via the URL.

  if (queryParams.selectedKind) {
    reduxStore.dispatch((0, _actions.selectStory)(queryParams.selectedKind, queryParams.selectedStory));
  }

  // Keep whichever of these are set that we don't override when stories change
  var originalQueryParams = queryParams;
  reduxStore.subscribe(function () {
    var _reduxStore$getState = reduxStore.getState(),
        selectedKind = _reduxStore$getState.selectedKind,
        selectedStory = _reduxStore$getState.selectedStory;

    var queryString = _qs2.default.stringify((0, _extends3.default)({}, originalQueryParams, {
      selectedKind: selectedKind,
      selectedStory: selectedStory
    }));
    window.history.replaceState({}, '', '?' + queryString);
  });

  // Handle keyEvents and pass them to the parent.
  window.onkeydown = function (e) {
    var parsedEvent = (0, _key_events2.default)(e);
    if (parsedEvent) {
      channel.emit('applyShortcut', { event: parsedEvent });
    }
  };
};

var _key_events = require('@storybook/ui/dist/libs/key_events');

var _key_events2 = _interopRequireDefault(_key_events);

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

var _actions = require('./actions');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }